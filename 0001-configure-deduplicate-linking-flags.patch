From 7e61836610f4c79b27322a14c7343f87f3d082c5 Mon Sep 17 00:00:00 2001
From: Ricardo Constantino <wiiaboo@gmail.com>
Date: Fri, 5 Jul 2019 16:27:59 +0100
Subject: [PATCH] configure: deduplicate linking flags

---
 configure | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/configure b/configure
index 98987ed186..976d18f45b 100755
--- a/configure
+++ b/configure
@@ -7471,6 +7471,19 @@ enabled stripping || striptype=""
 
 config_files="$TMPH ffbuild/config.mak doc/config.texi"
 
+if test "${#extralibs}" -gt 3000; then
+    extralib_dirs=""
+    for extralib_dir in $(printf '%s\n' $LDFLAGS $extralibs | grep '^-L' | tac | awk '!x[$0]++' | tac | tr '\n' ' '); do
+        test -d "${extralib_dir#-L}" && extralib_dirs+=" $extralib_dir"
+    done
+    extralibs_tmp="$(printf '%s\n' $extralibs | grep -v '^-L' | tr '\n' ' ')"
+    if test "${#extralibs_tmp}" -gt 2500; then
+        extralibs="$(printf '%s\n' $extralib_dirs $extralibs_tmp | tac | awk '!x[$0]++' | tac | tr '\n' ' ')"
+    else
+        extralibs="$extralib_dirs $extralibs_tmp"
+    fi
+fi
+
 cat > ffbuild/config.mak <<EOF
 # Automatically generated by configure - do not modify!
 ifndef FFMPEG_CONFIG_MAK
-- 
2.33.0

